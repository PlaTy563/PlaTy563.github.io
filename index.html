<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‹ã‚‚ã®ã¯ã—å®¶è¨ˆç°¿</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>
    <style>
        :root{--primary-color:#2e7d32;--primary-dark-variant:#266b2a;--primary-light-variant:#5cb85c;--background-light:#f8f8f8;--background-dark:#121212;--card-bg-light:#fff;--card-bg-dark:#1e1e1e;--text-color-light:#333;--text-color-dark:#e0e0e0;--border-color-light:#e0e0e0;--border-color-dark:#444}body{margin:0;font-family:'Noto Sans JP',sans-serif;padding-bottom:90px;background-color:var(--background-light);color:var(--text-color-light)}@media (prefers-color-scheme:dark){body{background-color:var(--background-dark);color:var(--text-color-dark)}section{background-color:var(--card-bg-dark)}input,select,button{background-color:var(--card-bg-dark);color:var(--text-color-dark);border-color:var(--border-color-dark)}table,th,td{border-color:var(--border-color-dark)}}header{display:flex;align-items:center;justify-content:center;padding:1rem;background-color:var(--primary-dark-variant);color:#fff;width:100%;box-shadow:0 4px 6px rgba(0,0,0,.1);max-width:48rem;margin:0 auto;border-bottom-left-radius:.75rem;border-bottom-right-radius:.75rem}header img{width:64px;height:64px;margin-right:1rem}header h1{font-size:1.75rem;font-weight:700;margin:0}main{display:flex;flex-direction:column;align-items:center;width:100%;max-width:48rem;margin:2rem auto;padding:0 1rem}section{background-color:var(--card-bg-light);padding:1.5rem;border-radius:.75rem;box-shadow:0 4px 6px rgba(0,0,0,.1);margin-bottom:1.5rem;width:100%}h2{font-size:1.25rem;font-weight:700;margin-top:0;margin-bottom:1rem}.tab-buttons{position:fixed;bottom:0;left:0;right:0;background-color:var(--primary-dark-variant);box-shadow:0 -4px 6px rgba(0,0,0,.1);display:flex;justify-content:space-around;padding:.75rem;z-index:10}.tab-buttons button{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:.5rem 0;border:none;background-color:transparent;color:#fff;font-size:.75rem;border-radius:.5rem;transition:background-color .2s}.tab-buttons button.active{background-color:var(--primary-light-variant)}.tab-buttons button span{font-size:1.5rem;line-height:1}form input,form select,form button{width:100%;padding:.75rem;border-radius:.5rem;border:1px solid var(--border-color-light);font-size:1rem;box-sizing:border-box}form > * {margin-bottom: 0.75rem;}button{background-color:var(--primary-color);color:#fff;font-weight:700;border:none;cursor:pointer;transition:background-color .2s}button:hover{background-color:var(--primary-light-variant)}.split-item-row{display:flex;gap:.5rem;align-items:center}.split-item-row select{flex:2}.split-item-row input{flex:2}.split-item-row button{flex-shrink:0;width:auto;padding:.5rem .75rem;font-size:1rem;line-height:1;background-color:#ef4444}#total-split-amount{font-size:1.25rem;font-weight:700;text-align:right;margin-top:1rem;color:var(--primary-dark-variant)}table{width:100%;border-collapse:collapse;margin-top:1rem;font-size:.875rem}th,td{padding:.75rem .5rem;border:1px solid var(--border-color-light);text-align:center}tr.split-group-start > td{border-top:2px solid var(--primary-color) !important}tr.split-child > td{border-top:1px dashed #ccc !important}.split-child .split-info-cell{color:#9ca3af}
    </style>
</head>
<body>
    <header>
        <img src="icon-512.png" alt="ã‹ã‚‚ã®ã¯ã—å®¶è¨ˆç°¿ãƒ­ã‚´">
        <h1>ã‹ã‚‚ã®ã¯ã—å®¶è¨ˆç°¿</h1>
    </header>

    <main id="mainContent">
        <div id="homeSection">
             <section>
                <h2>
                    <span style="font-size: 1.5rem; margin-right: 8px;">ğŸ“·</span>
                    ãƒ¬ã‚·ãƒ¼ãƒˆè‡ªå‹•å…¥åŠ› (OCR)
                </h2>
                <p style="font-size: 0.8rem; color: #6b7280; margin-top: -8px;">â€»APIã®ç„¡æ–™æ ï¼ˆ1åˆ†ã‚ãŸã‚Š60å›ï¼‰ã‚’è¶…ãˆãªã„ã‚ˆã†ã€1æ—¥ã®ä¸Šé™ã‚’50å›ã«åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚</p>
                <input type="file" id="receipt-uploader" accept="image/*" capture="environment">
                <button id="process-receipts-btn" style="margin-top: 0.5rem;">é¸æŠã—ãŸãƒ¬ã‚·ãƒ¼ãƒˆã‚’èª­ã¿å–ã‚‹</button>
                <div id="ocr-status" style="text-align: center; margin-top: 1rem; font-weight: bold;"></div>
                <div id="ocr-results" style="margin-top: 1rem; display: flex; flex-direction: column; gap: 8px;"></div>
            </section>
            <section>
                <h2>æ”¯å‡ºãƒ»åå…¥ã®è¨˜éŒ²</h2>
                <form id="recordForm" class="space-y-3">
                    <div style="display: flex; gap: 1rem;">
                        <input type="date" id="date" required>
                        <select id="type"><option value="expense">æ”¯å‡º</option><option value="income">åå…¥</option></select>
                    </div>
                    <input type="text" id="place" placeholder="å ´æ‰€ï¼ˆä¾‹ï¼šã‚¹ãƒ¼ãƒ‘ãƒ¼Aï¼‰" required>
                    <div id="split-items-container" class="space-y-2 border-t border-b py-4 my-2"></div>
                    <button type="button" id="add-split-item-btn" style="background-color: #e5e7eb; color: #1f2937;">ï¼‹ é …ç›®ã‚’è¿½åŠ </button>
                    <div id="total-split-amount">åˆè¨ˆ: Â¥0</div>
                    <input type="text" id="tags" placeholder="ã‚¿ã‚°ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã«é©ç”¨ï¼‰">
                    <input type="text" id="memo" placeholder="å‚™è€ƒï¼ˆã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã«é©ç”¨ï¼‰">
                    <button type="submit">è¨˜éŒ²</button>
                </form>
            </section>
            <section>
                <h2>å±¥æ­´</h2>
                <div class="scroll-table"><table><thead><tr><th>æ—¥ä»˜</th><th>å ´æ‰€</th><th>é‡‘é¡</th><th>ã‚¸ãƒ£ãƒ³ãƒ«</th><th>ãƒ¡ãƒ¢</th><th>ã‚¿ã‚°</th><th>æ“ä½œ</th></tr></thead><tbody id="historyBody"></tbody></table></div>
            </section>
        </div>
        <div id="settingsSection" style="display:none;">
            <section>
                <h2>ã‚¸ãƒ£ãƒ³ãƒ«ã®ç®¡ç†</h2>
                <div style="display: flex; gap: 8px;"><input type="text" id="newGenre" placeholder="æ–°ã—ã„ã‚¸ãƒ£ãƒ³ãƒ«å"><button id="addGenreBtn" style="width: auto; flex-shrink: 0;">è¿½åŠ </button></div>
                <div id="genreList" style="margin-top: 1rem;"></div>
            </section>
            <section>
                <h2>Gemini API ã‚­ãƒ¼è¨­å®š</h2>
                <input type="password" id="apiKeyInput" placeholder="ã“ã“ã«Gemini APIã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘">
                <button id="saveApiKeyBtn" style="margin-top: 0.5rem;">APIã‚­ãƒ¼ã‚’ä¿å­˜</button>
                <p style="font-size: 0.8rem; color: #6b7280; margin-top: 8px;">â€»APIã‚­ãƒ¼ã¯ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ã®ã¿å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
            </section>
        </div>
    </main>
    <div class="tab-buttons">
        <button id="homeTab" class="active"><span>ğŸ </span>ãƒ›ãƒ¼ãƒ </button>
        <button id="settingsTab"><span>âš™ï¸</span>è¨­å®š</button>
    </div>

    <script type="module">
        // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
        let transactions = [];
        let genres = ['é£Ÿè²»', 'æ—¥ç”¨å“', 'äº¤é€šè²»', 'å¨¯æ¥½è²»', 'å¤–é£Ÿ', 'å…‰ç†±è²»', 'é€šä¿¡è²»', 'å®¶è³ƒ', 'çµ¦ä¸', 'ãã®ä»–åå…¥'];
        const LOCAL_STORAGE_KEY = 'kakeiboData';

        // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
        function generateUniqueId() { return Date.now().toString(36) + Math.random().toString(36).substring(2, 9); }

        function loadData() {
            const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (!storedData) return;
            const data = JSON.parse(storedData);
            transactions = data.transactions || [];
            genres = data.genres || ['é£Ÿè²»', 'æ—¥ç”¨å“', 'äº¤é€šè²»', 'å¨¯æ¥½è²»', 'å¤–é£Ÿ', 'å…‰ç†±è²»', 'é€šä¿¡è²»', 'å®¶è³ƒ', 'çµ¦ä¸', 'ãã®ä»–åå…¥'];
        }

        function saveData() {
            const dataToSave = { transactions, genres };
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataToSave));
        }

        // --- UIæ›´æ–° ---
        function renderApp() {
            updateHistoryTable();
            updateGenreManagementList();
            updateSplitItemGenreSelects();
        }
        
        function switchTab(tabName) {
            document.getElementById('homeSection').style.display = (tabName === 'home' ? 'block' : 'none');
            document.getElementById('settingsSection').style.display = (tabName === 'settings' ? 'block' : 'none');
            document.getElementById('homeTab').classList.toggle('active', tabName === 'home');
            document.getElementById('settingsTab').classList.toggle('active', tabName === 'settings');
        }
        
        function updateGenreManagementList() {
            const genreListDiv = document.getElementById('genreList');
            genreListDiv.innerHTML = '';
            genres.forEach(g => {
                const itemDiv = document.createElement('div');
                itemDiv.style.display = 'flex';
                itemDiv.style.justifyContent = 'space-between';
                itemDiv.innerHTML = `<span>${g}</span><button class="delete-btn" data-genre="${g}" style="width:auto;padding:2px 6px;margin-left:8px;">&times;</button>`;
                genreListDiv.appendChild(itemDiv);
                itemDiv.querySelector('.delete-btn').addEventListener('click', e => deleteGenre(e.target.dataset.genre));
            });
        }
        
        function updateHistoryTable() {
            const historyBody = document.getElementById('historyBody');
            historyBody.innerHTML = '';
            const sortedTransactions = [...transactions].sort((a,b) => (b.date > a.date) ? 1 : ((a.date > b.date) ? -1 : 0));
            sortedTransactions.forEach((transaction, index) => {
                const row = historyBody.insertRow();
                let isSplitChild = transaction.splitGroupId && index > 0 && sortedTransactions[index - 1].splitGroupId === transaction.splitGroupId;
                if (transaction.splitGroupId && !isSplitChild) row.classList.add('split-group-start');
                if (isSplitChild) row.classList.add('split-child');
                const infoCell = (content) => isSplitChild ? `<span class="split-info-cell">${content || ''}</span>` : `<span>${content || ''}</span>`;
                row.innerHTML = `<td>${infoCell(transaction.date)}</td><td>${infoCell(transaction.place)}</td><td style="color: ${transaction.type === 'expense' ? 'red' : 'green'};">${new Intl.NumberFormat().format(transaction.amount)}å††</td><td>${transaction.genre}</td><td>${infoCell(transaction.memo)}</td><td>${infoCell(transaction.tags)}</td><td><button class="delete-btn" data-timestamp="${transaction.timestamp}">å‰Šé™¤</button></td>`;
                row.querySelector('.delete-btn').addEventListener('click', (e) => deleteTransaction(e.target.dataset.timestamp));
            });
        }

        // --- åˆ†å‰²æ©Ÿèƒ½ ---
        function addSplitItemRow(container) {
            const row = document.createElement('div');
            row.className = 'split-item-row';
            const genreSelect = document.createElement('select');
            genreSelect.className = 'split-genre';
            updateGenreOptions(genreSelect);
            const amountInput = document.createElement('input');
            amountInput.type = 'number'; amountInput.className = 'split-amount';
            amountInput.placeholder = 'é‡‘é¡'; amountInput.min = '0';
            amountInput.addEventListener('input', updateSplitTotal);
            const deleteBtn = document.createElement('button');
            deleteBtn.type = 'button'; deleteBtn.textContent = 'âœ–';
            deleteBtn.addEventListener('click', () => {
                if (container.querySelectorAll('.split-item-row').length > 1) { row.remove(); updateSplitTotal(); }
            });
            row.appendChild(genreSelect); row.appendChild(amountInput); row.appendChild(deleteBtn);
            container.appendChild(row);
        }

        function updateGenreOptions(selectElement) {
            selectElement.innerHTML = '';
            genres.filter(g => !['çµ¦ä¸', 'ãã®ä»–åå…¥'].includes(g)).forEach(g => {
                const option = document.createElement('option');
                option.value = g; option.textContent = g;
                selectElement.appendChild(option);
            });
        }

        function updateSplitItemGenreSelects() {
            document.querySelectorAll('.split-genre').forEach(updateGenreOptions);
        }

        function updateSplitTotal() {
            const container = document.getElementById('split-items-container');
            const amounts = Array.from(container.querySelectorAll('.split-amount'));
            const total = amounts.reduce((sum, input) => sum + (parseInt(input.value) || 0), 0);
            document.getElementById('total-split-amount').textContent = `åˆè¨ˆ: ${new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(total)}`;
        }
        
        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© ---
        function handleRecordSubmit(e) {
            e.preventDefault();
            const date = document.getElementById('date').value;
            const place = document.getElementById('place').value;
            const type = document.getElementById('type').value;
            const memo = document.getElementById('memo').value;
            const tags = document.getElementById('tags').value;
            const splitItems = document.querySelectorAll('.split-item-row');
            if (!place) { alert('å ´æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
            const splitGroupId = generateUniqueId();
            let recordsToAdd = [];
            splitItems.forEach(item => {
                const genre = item.querySelector('.split-genre').value;
                const amount = parseInt(item.querySelector('.split-amount').value);
                if (genre && amount > 0) {
                    recordsToAdd.push({ date, place, type, memo, tags, genre, amount, splitGroupId, timestamp: generateUniqueId() });
                }
            });
            if (recordsToAdd.length > 0) {
                transactions.push(...recordsToAdd);
                saveData();
                renderApp();
                document.getElementById('recordForm').reset();
                document.getElementById('date').valueAsDate = new Date();
                const container = document.getElementById('split-items-container');
                container.innerHTML = ''; addSplitItemRow(container); updateSplitTotal();
            } else {
                alert('æœ‰åŠ¹ãªé‡‘é¡ã‚’æŒã¤é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
            }
        }
        
        function deleteTransaction(timestamp) {
            const txToDelete = transactions.find(t => t.timestamp === timestamp);
            if (!txToDelete) return;
            let msg = 'ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ';
            if (txToDelete.splitGroupId && transactions.filter(t => t.splitGroupId === txToDelete.splitGroupId).length > 1) {
                msg = 'ã“ã‚Œã¯åˆ†å‰²è¨˜éŒ²ã®ä¸€éƒ¨ã§ã™ã€‚ã“ã®é …ç›®ã®ã¿å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ';
            }
            if (window.confirm(msg)) {
                transactions = transactions.filter(t => t.timestamp !== timestamp);
                saveData();
                renderApp();
            }
        }

        function addGenre() {
            const newGenreInput = document.getElementById('newGenre');
            const newGenreName = newGenreInput.value.trim();
            if (newGenreName && !genres.includes(newGenreName)) {
                genres.push(newGenreName);
                genres.sort();
                saveData();
                renderApp();
                newGenreInput.value = '';
            }
        }

        function deleteGenre(genreName) {
            if (window.confirm(`ã€Œ${genreName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                genres = genres.filter(g => g !== genreName);
                saveData();
                renderApp();
            }
        }

        // --- OCRæ©Ÿèƒ½ ---
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        async function handleReceiptProcessing() {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) {
                alert('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã€Œè¨­å®šã€ç”»é¢ã§APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
                switchTab('settings');
                return;
            }
            const uploader = document.getElementById('receipt-uploader');
            const statusDiv = document.getElementById('ocr-status');
            const resultsDiv = document.getElementById('ocr-results');
            const files = uploader.files;
            if (files.length === 0) { alert('ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'); return; }

            statusDiv.textContent = 'å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...'; resultsDiv.innerHTML = '';
            const SAFE_LIMIT_PER_DAY = 50;
            const today = new Date().toISOString().slice(0, 10);
            let usageCount = parseInt(localStorage.getItem(`ocrUsage_${today}`) || '0');

            if (usageCount >= SAFE_LIMIT_PER_DAY) {
                statusDiv.textContent = `1æ—¥ã®ä¸Šé™ï¼ˆ${SAFE_LIMIT_PER_DAY}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚`;
                return;
            }

            const genAI = new window.GoogleGenerativeAI(apiKey);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (usageCount >= SAFE_LIMIT_PER_DAY) {
                    statusDiv.textContent = `1æ—¥ã®ä¸Šé™ã«é”ã—ãŸãŸã‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã—ãŸã€‚`;
                    break;
                }
                statusDiv.textContent = `(${i + 1}/${files.length}) ${file.name} ã‚’èª­ã¿å–ã‚Šä¸­...`;
                try {
                    const base64Image = await fileToBase64(file);
                    const prompt = `ã“ã®ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’æŠ½å‡ºã—ã€å¿…ãšJSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚- place: åº—å (æ–‡å­—åˆ—) - date: æ—¥ä»˜ (YYYY-MM-DDå½¢å¼ã®æ–‡å­—åˆ—) - total: åˆè¨ˆé‡‘é¡ (æ•°å€¤) æƒ…å ±ãŒèª­ã¿å–ã‚Œãªã„å ´åˆã¯ã€è©²å½“ã™ã‚‹å€¤ã« "ä¸æ˜" ã¾ãŸã¯ 0 ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚`;
                    const imagePart = { inlineData: { data: base64Image, mimeType: file.type } };
                    const result = await model.generateContent([prompt, imagePart]);
                    const responseText = result.response.text().replace(/```json|```/g, '').trim();
                    const data = JSON.parse(responseText);

                    const card = document.createElement('div');
                    card.style.border = '1px solid #ccc'; card.style.padding = '12px'; card.style.cursor = 'pointer';
                    card.innerHTML = `<strong>åº—å:</strong> ${data.place || 'ä¸æ˜'}<br><strong>æ—¥ä»˜:</strong> ${data.date || 'ä¸æ˜'}<br><strong>åˆè¨ˆ:</strong> ${new Intl.NumberFormat().format(data.total || 0)} å††`;
                    card.onclick = () => {
                        document.getElementById('place').value = data.place || '';
                        if(data.date && data.date !== 'ä¸æ˜') document.getElementById('date').value = data.date;
                        const container = document.getElementById('split-items-container');
                        container.innerHTML = ''; addSplitItemRow(container);
                        container.querySelector('.split-amount').value = data.total || '';
                        updateSplitTotal();
                        alert(`ã€Œ${data.place}ã€ã®æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¾ã—ãŸã€‚`);
                    };
                    resultsDiv.appendChild(card);
                    usageCount++;
                    localStorage.setItem(`ocrUsage_${today}`, usageCount);
                } catch (err) {
                    console.error("OCRå‡¦ç†ã‚¨ãƒ©ãƒ¼:", err);
                    const errorCard = document.createElement('div');
                    errorCard.style.color = 'red'; errorCard.textContent = `${file.name} - èª­ã¿å–ã‚Šå¤±æ•—`;
                    resultsDiv.appendChild(errorCard);
                }
            }
            statusDiv.textContent = 'å…¨ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚';
            uploader.value = ''; // é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
        }

        // --- åˆæœŸåŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            document.getElementById('homeTab').addEventListener('click', () => switchTab('home'));
            document.getElementById('settingsTab').addEventListener('click', () => switchTab('settings'));
            document.getElementById('recordForm').addEventListener('submit', handleRecordSubmit);
            document.getElementById('add-split-item-btn').addEventListener('click', () => addSplitItemRow(document.getElementById('split-items-container')));
            document.getElementById('addGenreBtn').addEventListener('click', addGenre);
            
            const apiKeyInput = document.getElementById('apiKeyInput');
            const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
            if (apiKeyInput) apiKeyInput.value = localStorage.getItem('geminiApiKey') || '';
            if (saveApiKeyBtn) saveApiKeyBtn.addEventListener('click', () => {
                const key = apiKeyInput.value.trim();
                if (key) { localStorage.setItem('geminiApiKey', key); alert('APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚'); } 
                else { alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); }
            });
            document.getElementById('process-receipts-btn').addEventListener('click', handleReceiptProcessing);
            
            const container = document.getElementById('split-items-container');
            addSplitItemRow(container);
            updateSplitTotal();
            document.getElementById('date').valueAsDate = new Date();
            
            switchTab('home');
            renderApp();
        });
    </script>
</body>
</html>